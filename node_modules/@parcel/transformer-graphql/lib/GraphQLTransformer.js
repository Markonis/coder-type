"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

function _plugin() {
  const data = require("@parcel/plugin");

  _plugin = function () {
    return data;
  };

  return data;
}

function _graphql() {
  const data = require("graphql");

  _graphql = function () {
    return data;
  };

  return data;
}

function _graphqlImportMacro() {
  const data = require("graphql-import-macro");

  _graphqlImportMacro = function () {
    return data;
  };

  return data;
}

var _default = new (_plugin().Transformer)({
  async transform({
    asset,
    options,
    resolve
  }) {
    const document = (0, _graphql().parse)(new (_graphql().Source)(await asset.getCode(), asset.filePath));
    const expandedDocument = await (0, _graphqlImportMacro().processDocumentImports)(document, loadImport);

    async function loadImport(to, from) {
      const filePath = await resolve(to, from);
      asset.invalidateOnFileChange(filePath);
      return (0, _graphql().parse)(new (_graphql().Source)(await options.inputFS.readFile(filePath, 'utf-8'), filePath));
    }

    const generated = asset.env.shouldOptimize ? (0, _graphql().stripIgnoredCharacters)((0, _graphql().print)(expandedDocument)) : (0, _graphql().print)(expandedDocument);
    asset.type = 'js';
    asset.setCode(`module.exports=${JSON.stringify(generated)};`);
    return [asset];
  }

});

exports.default = _default;